(self.webpackChunke_commerce_mosh=self.webpackChunke_commerce_mosh||[]).push([[563],{66563:(t,e,r)=>{"use strict";r.r(e),r.d(e,{BuyLazyModule:()=>I});var n=r(61116),o=r(29996),s=r(35366),i=r(27455),u=r(65031),d=r(42590),c=r(2212),a=r(54670),l=r(13070),m=r(9550),p=r(84369),h=r(59241),y=r(31041);function f(t,e){if(1&t&&(s["\u0275\u0275elementStart"](0,"div",2),s["\u0275\u0275elementStart"](1,"h3"),s["\u0275\u0275text"](2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&t){const t=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"]("Cantidad Total: ",t.orderProducts.buyItemsCount,"")}}function b(t,e){1&t&&(s["\u0275\u0275elementStart"](0,"span",20),s["\u0275\u0275text"](1,"Agregue productos a la compra"),s["\u0275\u0275elementEnd"]())}function g(t,e){if(1&t){const t=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"tr"),s["\u0275\u0275elementStart"](1,"td",21),s["\u0275\u0275text"](2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](3,"td"),s["\u0275\u0275elementStart"](4,"input",22,23),s["\u0275\u0275listener"]("ngModelChange",function(t){return e.$implicit.quantity=t})("blur",function(){const e=s["\u0275\u0275restoreView"](t).$implicit;return s["\u0275\u0275nextContext"]().setBuyItemQuantity(e,e.quantity)}),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](6,"td"),s["\u0275\u0275text"](7),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](8,"button",11),s["\u0275\u0275listener"]("click",function(){const e=s["\u0275\u0275restoreView"](t).$implicit;return s["\u0275\u0275nextContext"]().updateBuyItemQuantity(e,-1)}),s["\u0275\u0275text"](9,"-"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](10,"button",11),s["\u0275\u0275listener"]("click",function(){const e=s["\u0275\u0275restoreView"](t).$implicit;return s["\u0275\u0275nextContext"]().updateBuyItemQuantity(e,1)}),s["\u0275\u0275text"](11,"+"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}if(2&t){const t=e.$implicit,r=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"]("",t.product.title,"\xa0\xa0\xa0\xa0"),s["\u0275\u0275advance"](2),s["\u0275\u0275propertyInterpolate"]("placeholder",t.quantity),s["\u0275\u0275property"]("ngModel",t.quantity),s["\u0275\u0275advance"](3),s["\u0275\u0275textInterpolate"](r.getQuantityOfP(t))}}const v=[{path:"",component:(()=>{class t{constructor(t,e,r,n,o){this.stockService=t,this.productService=e,this.route=r,this.router=n,this.auth=o,this.buyEmpty=!1}ngOnInit(){this.subscription2=this.auth.appUser$.subscribe(t=>{this.appUser=t,this.subscription3=this.productService.getAllProducts().subscribe(t=>{this.products=t,this.orderProducts=this.buildOrderProducts(this.products),this.subscription4=this.route.queryParamMap.subscribe(t=>{if(this.prodsCategory=t.get("prodsCategory"),this.filteredBuy=[],this.orderProducts){for(let t=0;t<this.orderProducts.products.length;t++)this.orderProducts.products[t].product.prodsCategory==this.prodsCategory&&this.filteredBuy.push(this.orderProducts.products[t]);if(0==this.filteredBuy.length)for(let t=0;t<this.orderProducts.products.length;t++)this.filteredBuy.push(this.orderProducts.products[t]);this.showedProducts=this.filteredBuy}})})})}filter(t){this.prodQuery=t,""!=t?(this.showedProducts=t?this.showedProducts.filter(e=>e.product.title.toLowerCase().includes(t.toLowerCase())):this.showedProducts,console.log("this.showedProducts ",this.showedProducts)):this.showedProducts=this.filteredBuy}buildOrderProducts(t){let e=[];return t.forEach(t=>{let r={price:t.payload.val().buyPrice,product:t.payload.val(),productId:t.key,quantity:0};e.push(r)}),{buyItemsCount:0,products:e}}updateBuyItemQuantity(t,e){for(let r=0;r<this.orderProducts.products.length;r++)this.orderProducts.products[r].productId==t.productId&&(this.orderProducts.products[r].quantity+=e);this.orderProducts.buyItemsCount+=e}setBuyItemQuantity(t,e){let r=parseInt(e);for(let n=0;n<this.orderProducts.products.length;n++)if(this.orderProducts.products[n].productId==t.productId){if(!Number.isInteger(r))return void(this.orderProducts.products[n].quantity=0);this.orderProducts.products[n].quantity=r}this.orderProducts.buyItemsCount+=parseInt(e)}sortData(t){const e=this.filteredBuy;this.sortedData=t.active&&""!==t.direction?e.sort((e,r)=>{const n="asc"===t.direction;switch(t.active){case"title":return this.compare(e.payload.val().product.title,r.payload.val().product.title,n);case"quantity":return this.compare(e.payload.val().quantity,r.payload.val().quantity,n);case"stock":return this.compare(this.getQuantityOfP(e),this.getQuantityOfP(r),n);default:return 0}}):e}compare(t,e,r){return(t<e?-1:1)*(r?1:-1)}sendBuy(){if(0==this.orderProducts.buyItemsCount)return this.buyEmpty=!0,void setTimeout(()=>{this.buyEmpty=!1},2e3);confirm("Est\xe1 segur@ que quiere cargar la compra? No podr\xe1 modificarla")&&(this.stockService.sendBuy(this.orderProducts),this.productService.updateStocks(this.orderProducts.products,this.products,!0),this.router.navigate(["/stock/stock"]))}reset(){confirm("Est\xe1 segur@ que quiere anular la compra? aun no fue cargada")&&this.stockService.reset()}getQuantityOfP(t){return this.stockService.getQuantityOfP(t)}ngOnDestroy(){this.subscription2.unsubscribe(),this.subscription3.unsubscribe(),this.subscription4.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](i.q),s["\u0275\u0275directiveInject"](u.M),s["\u0275\u0275directiveInject"](o.gz),s["\u0275\u0275directiveInject"](o.F0),s["\u0275\u0275directiveInject"](d.e))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["app-buy"]],decls:37,vars:3,consts:[[1,"container-grid"],[1,"ms-3","row"],[1,"col-3"],["class","col-3",4,"ngIf"],[1,"ms-3"],[1,"col-4","col-sm-3","m-3","col-lg-3"],[1,"input-group"],["matSuffix",""],["matInput","","type","text","placeholder","   Buscar producto...",1,"border-end-0","border","rounded-pill",3,"keyup"],["prodQuery",""],[1,"ms-3","mb-3"],["mat-raised-button","","color","basic",1,"left-btn",3,"click"],["mat-raised-button","","color","warn",1,"left-btn",3,"click"],["class","text-danger border border-danger p-2 mt-5 mb-5 rounded",4,"ngIf"],["matSort","",1,"mt-3",3,"matSortChange"],["mat-sort-header","title"],["mat-sort-header","quantity"],["mat-sort-header","stock"],[4,"ngFor","ngForOf"],["mat-raised-button","","color","basic","routerLink","/stock/stock",1,"left-btn",3,"click"],[1,"text-danger","border","border-danger","p-2","mt-5","mb-5","rounded"],[2,"max-width","280px"],["matInput","","name","amount",3,"ngModel","placeholder","ngModelChange","blur"],["amount","ngModel"]],template:function(t,e){if(1&t){const t=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"div",0),s["\u0275\u0275elementStart"](1,"div",1),s["\u0275\u0275elementStart"](2,"div",2),s["\u0275\u0275elementStart"](3,"h1"),s["\u0275\u0275text"](4,"Nueva Compra"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](5,f,3,1,"div",3),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](6,"div",4),s["\u0275\u0275element"](7,"product-filter"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](8,"div",5),s["\u0275\u0275elementStart"](9,"div",6),s["\u0275\u0275elementStart"](10,"div"),s["\u0275\u0275elementStart"](11,"mat-icon",7),s["\u0275\u0275text"](12,"search"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](13,"div"),s["\u0275\u0275elementStart"](14,"input",8,9),s["\u0275\u0275listener"]("keyup",function(){s["\u0275\u0275restoreView"](t);const r=s["\u0275\u0275reference"](15);return e.filter(r.value)}),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](16,"div",10),s["\u0275\u0275elementStart"](17,"button",11),s["\u0275\u0275listener"]("click",function(){return e.sendBuy()}),s["\u0275\u0275text"](18,"Cargar compra"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](19,"button",12),s["\u0275\u0275listener"]("click",function(){return e.reset()}),s["\u0275\u0275text"](20,"Anular "),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](21,"div",4),s["\u0275\u0275template"](22,b,2,0,"span",13),s["\u0275\u0275elementStart"](23,"table",14),s["\u0275\u0275listener"]("matSortChange",function(t){return e.sortData(t)}),s["\u0275\u0275elementStart"](24,"tr"),s["\u0275\u0275elementStart"](25,"th",15),s["\u0275\u0275text"](26,"Producto"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](27,"th",16),s["\u0275\u0275text"](28,"Cantidad"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](29,"th",17),s["\u0275\u0275text"](30,"Stock actual"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](31,g,12,4,"tr",18),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](32,"div",4),s["\u0275\u0275elementStart"](33,"button",19),s["\u0275\u0275listener"]("click",function(){return e.sendBuy()}),s["\u0275\u0275text"](34,"Cargar compra"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](35,"button",12),s["\u0275\u0275listener"]("click",function(){return e.reset()}),s["\u0275\u0275text"](36,"Anular "),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}2&t&&(s["\u0275\u0275advance"](5),s["\u0275\u0275property"]("ngIf",e.orderProducts),s["\u0275\u0275advance"](17),s["\u0275\u0275property"]("ngIf",e.buyEmpty),s["\u0275\u0275advance"](9),s["\u0275\u0275property"]("ngForOf",e.showedProducts))},directives:[n.O5,c.N,a.Hw,l.R9,m.Nt,p.lW,h.YE,h.nU,n.sg,o.rH,y.DefaultValueAccessor,y.NgControlStatus,y.NgModel],styles:[""]}),t})()}];let S=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({imports:[[o.Bz.forChild(v)],o.Bz]}),t})();var E=r(87660),P=r(99484);let I=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({imports:[[n.ez,S,E.q,y.ReactiveFormsModule,y.FormsModule,P.t]]}),t})()}}]);